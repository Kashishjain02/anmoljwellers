{% extends 'base.html' %}
{% block title %}Search{% if query %}: {{ query }}{% endif %} - Anmol Jewellers - Hallmarked Gold & Silver Jewellery{% endblock %}
{% block content %}
<h2>Search{% if query %}: “{{ query }}”{% endif %}</h2>

<form method="get" action="/search/" class="filter-form">
  <div class="grid">
    <input type="search" name="q" placeholder="Search" value="{{ query }}" />
    <select name="category">
      <option value="">All Categories</option>
      {% for c in categories %}
        <option value="{{ c.slug }}" {% if active.category == c.slug %}selected{% endif %}>{{ c.name }}</option>
      {% endfor %}
    </select>
    <input type="number" name="min_price" placeholder="Min Price" value="{{ active.min_price }}" />
    <input type="number" name="max_price" placeholder="Max Price" value="{{ active.max_price }}" />
    <input type="text" name="metal" placeholder="Metal (e.g. Gold)" value="{{ active.metal }}" />
    <input type="text" name="gemstone" placeholder="Gemstone (e.g. Diamond)" value="{{ active.gemstone }}" />
    <select name="sort">
      <option value="">Sort By</option>
      <option value="new" {% if active.sort == 'new' %}selected{% endif %}>Newest</option>
      <option value="price_asc" {% if active.sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
      <option value="price_desc" {% if active.sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
    </select>
  </div>
  <button type="submit">Apply Filters</button>
  <a href="/search/" class="secondary" role="button">Reset</a>
</form>

<div class="product-grid">
  {% for product in products %}
    <article class="product-card">
      <a href="{% url 'product_detail' product.slug %}">
        <div class="product-thumb">
          {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}" />
          {% endif %}
        </div>
        <h3>{{ product.name }}</h3>
      </a>
      <p class="price">₹ {{ product.price }}</p>
      <form method="post" action="{% url 'add_to_cart' product.id %}">
        {% csrf_token %}
        <button type="submit">Add to Cart</button>
      </form>
    </article>
  {% empty %}
    <p>No products found.</p>
  {% endfor %}
</div>
{% endblock %}


